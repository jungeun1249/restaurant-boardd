<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title><%= post.title %> - ë§›ì§‘ ê²Œì‹œíŒ</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f8f9fa; font-family: 'Pretendard', sans-serif; }
    .post-container { max-width: 900px; margin: 50px auto; background: white; padding: 40px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    .post-title { font-size: 2rem; font-weight: bold; text-align: center; margin-bottom: 10px; }
    .post-meta { text-align: center; color: #888; margin-bottom: 25px; }
    .post-image { display: block; margin: 0 auto 30px; max-width: 800px; width: 70%; border-radius: 12px; object-fit: cover; }
    .post-content { font-size: 1.1rem; line-height: 1.7; margin-bottom: 15px; text-align: center; }
    .rating { font-size: 1.2rem; text-align: center; margin-bottom: 25px; color: #ffb703; }
    .map-container { height: 350px; border-radius: 10px; margin-bottom: 15px; overflow: hidden; }
    .map-link { display: block; width: 100%; background: #0078ff; color: white; padding: 10px; border-radius: 8px; text-decoration: none; text-align: center; font-weight: bold; }
    .map-link:hover { background: #005fcc; }
    textarea { resize: none; }
    .comment-box { margin-top: 40px; }
    .comment-item { background: #f1f3f5; padding: 12px 15px; border-radius: 10px; margin-bottom: 10px; }
  </style>
  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=d167bce40f724f4556f19ac97ffbd95d"></script>
</head>
<body>
  <div class="post-container">
    <h2 class="post-title"><%= post.title %></h2>
    <p class="post-meta">ì‘ì„±ì: <%= post.nickname %> | ì‘ì„±ì¼: <%= new Date(post.createdAt).toLocaleString() %></p>

    <% if (post.image) { %>
      <img src="/uploads/<%= post.image %>" alt="ê²Œì‹œê¸€ ì´ë¯¸ì§€" class="post-image">
    <% } %>

    <div class="post-content"><%= post.content %></div>
    <div class="rating">â­ í‰ì : <%= post.rating %>/5</div>

    <% if (post.lat && post.lng) { %>
      <div id="map" class="map-container"></div>
      <a 
        href="https://map.kakao.com/link/to/<%= encodeURIComponent(post.title) %>,<%= post.lat %>,<%= post.lng %>" 
        target="_blank" 
        class="map-link">
        ğŸ§­ ì¹´ì¹´ì˜¤ë§µìœ¼ë¡œ ê¸¸ì°¾ê¸°
      </a>

      <script>
        const mapContainer = document.getElementById('map');
        const mapOption = {
          center: new kakao.maps.LatLng(<%= post.lat %>, <%= post.lng %>),
          level: 3
        };
        const map = new kakao.maps.Map(mapContainer, mapOption);

        const markerPosition = new kakao.maps.LatLng(<%= post.lat %>, <%= post.lng %>);
        const marker = new kakao.maps.Marker({ position: markerPosition });
        marker.setMap(map);

        const infoWindow = new kakao.maps.InfoWindow({
          content: `<div style="padding:6px 12px;font-size:14px;font-weight:bold;">ğŸ“ <%= post.title %></div>`
        });
        infoWindow.open(map, marker);
      </script>
    <% } %>

    <% if (session.user && session.user.nickname === post.nickname) { %>
      <div class="text-center mb-4 mt-3">
        <a href="/edit/<%= post.id %>" class="btn btn-warning me-2">âœï¸ ìˆ˜ì •</a>
        <form action="/delete/<%= post.id %>" method="POST" style="display:inline;">
          <button class="btn btn-danger" onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ğŸ—‘ï¸ ì‚­ì œ</button>
        </form>
      </div>
    <% } %>

    <hr>

    <div class="comment-box">
      <h5>ğŸ’¬ ëŒ“ê¸€</h5>
      <form action="/post/<%= post.id %>/comment" method="POST" class="mb-3">
        <textarea name="content" class="form-control mb-2" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
        <button class="btn btn-primary w-100">ëŒ“ê¸€ ë“±ë¡</button>
      </form>

      <% if (comments.length > 0) { %>
        <% comments.forEach(c => { %>
          <div class="comment-item">
            <strong><%= c.nickname %></strong> 
            <small class="text-muted float-end"><%= new Date(c.createdAt).toLocaleString() %></small>
            <p class="mb-0"><%= c.content %></p>
            <% if (session.user && session.user.nickname === c.nickname) { %>
              <div class="mt-2 text-end">
                <a href="/comment/<%= c.id %>/edit" class="btn btn-sm btn-outline-warning">ìˆ˜ì •</a>
                <form action="/comment/<%= c.id %>/delete" method="POST" style="display:inline;">
                  <button class="btn btn-sm btn-outline-danger">ì‚­ì œ</button>
                </form>
              </div>
            <% } %>
          </div>
        <% }) %>
      <% } else { %>
        <p class="text-muted">ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
      <% } %>
    </div>

    <div class="text-center mt-4">
      <a href="/board" class="btn btn-secondary">â† ê²Œì‹œíŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>
  </div>
</body>
</html>
